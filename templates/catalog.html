{% extends "base.html" %}

{% block content %}
<h2>Product Catalog</h2>

<form method="get" class="form-card" style="margin-bottom: 1rem;">
  <label for="q">Search by name or color</label>
  <input type="text" id="q" name="q" value="{{ query }}">

  <label for="color">Filter by color</label>
  <input type="text" id="color" name="color" value="{{ color_filter }}">

  <button type="submit">Search</button>
</form>

<div class="product-grid">
  {% for p in products %}
    <div class="product-card">
      <h3>{{ p.name }}</h3>
      <p>{{ p.description }}</p>
      <p><strong>Color:</strong> {{ p.color }}</p>
      <p><strong>Sizes:</strong> {{ p.sizes|join(', ') }}</p>
      <p><strong>Price:</strong> ${{ '%.2f'|format(p.price) }}</p>
      <p><strong>In stock:</strong> {{ p.stock }}</p>

      {% if session.get('user_email') %}
          {% if p.stock > 0 %}
            <form action="{{ url_for('cart.add', product_id=p.id) }}" method="get">
              <label for="size_{{ p.id }}">Size:</label>
              <select name="size" id="size_{{ p.id }}" required>
                {% for s in p.sizes %}
                  <option value="{{ s }}">{{ s }}</option>
                {% endfor %}
              </select>
              <button type="submit">Add to Cart</button>
            </form>
          {% else %}
            <span style="color:red;">Out of stock</span>
          {% endif %}
        {% else %}
          <a class="button" href="{{ url_for('auth.login') }}">Login to Buy</a>
      {% endif %}

    </div>
  {% else %}
    <p>No products found.</p>
  {% endfor %}
</div>
{% endblock %}
