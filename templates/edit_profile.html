{% extends "base.html" %}

{% block content %}
<div style="margin-bottom: 1rem;">
  <a href="{{ url_for('profile.view_profile') }}" class="button ghost">‚Üê Back to Profile</a>
</div>

<h2>Edit Profile</h2>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
  
  <!-- Upload Profile Picture -->
  <div>
    <div style="background: white; padding: 2rem; border: 1px solid #e1e4e8; border-radius: 6px;">
      <h3>Profile Picture</h3>
      
      <!-- Current Picture -->
      <div style="text-align: center; margin: 1.5rem 0;">
        <div style="width: 200px; height: 200px; border-radius: 50%; overflow: hidden; border: 3px solid #e1e4e8; margin: 0 auto;">
          {% if user.has_profile_picture() %}
            <img src="{{ user.get_profile_picture_url() }}" alt="Profile Picture" style="width: 100%; height: 100%; object-fit: cover;">
          {% else %}
            <div style="width: 100%; height: 100%; background: #f6f8fa; display: flex; align-items: center; justify-content: center; font-size: 4rem;">
              üë§
            </div>
          {% endif %}
        </div>
        
        {% if user.profile_picture_status == 'pending' %}
          <p style="color: #ffc107; margin-top: 1rem;">‚è≥ Awaiting Admin Approval</p>
        {% elif user.profile_picture_status == 'approved' %}
          <p style="color: #28a745; margin-top: 1rem;">‚úÖ Approved</p>
        {% elif user.profile_picture_status == 'rejected' %}
          <p style="color: #dc3545; margin-top: 1rem;">‚ùå Rejected - Upload a new picture</p>
        {% endif %}
      </div>

      <!-- Upload Form -->
      <form method="post" action="{{ url_for('profile.edit_profile') }}" enctype="multipart/form-data">
        <input type="hidden" name="action" value="upload_picture">
        
        <div style="margin-bottom: 1rem;">
          <label for="profile_picture">Choose New Picture:</label>
          <input type="file" id="profile_picture" name="profile_picture" accept="image/png, image/jpeg, image/jpg, image/gif" required style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5da; border-radius: 4px;">
          <small style="color: #6a737d;">Allowed: PNG, JPG, JPEG, GIF. Max 5MB</small>
        </div>

        <div style="padding: 1rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-bottom: 1rem;">
          <strong>‚ö†Ô∏è Note:</strong> Your profile picture will be reviewed by an admin before it appears on your profile.
        </div>

        <button type="submit" style="width: 100%;">Upload Picture</button>
      </form>
    </div>
  </div>

  <!-- Change Password -->
  <div>
    <div style="background: white; padding: 2rem; border: 1px solid #e1e4e8; border-radius: 6px;">
      <h3>Change Password</h3>
      
      <form method="post" action="{{ url_for('profile.edit_profile') }}">
        <input type="hidden" name="action" value="change_password">
        
        <div style="margin-bottom: 1rem;">
          <label for="current_password">Current Password:</label>
          <input type="password" id="current_password" name="current_password" required style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5da; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 1rem;">
          <label for="new_password">New Password:</label>
          <input type="password" id="new_password" name="new_password" required minlength="6" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5da; border-radius: 4px;">
          <small style="color: #6a737d;">Minimum 6 characters</small>
        </div>

        <div style="margin-bottom: 1rem;">
          <label for="confirm_password">Confirm New Password:</label>
          <input type="password" id="confirm_password" name="confirm_password" required minlength="6" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5da; border-radius: 4px;">
        </div>

        <button type="submit" style="width: 100%;">Change Password</button>
      </form>
    </div>

    <!-- Account Info -->
    <div style="background: #f6f8fa; padding: 1.5rem; border: 1px solid #e1e4e8; border-radius: 6px; margin-top: 1.5rem;">
      <h4>Account Details</h4>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>Member Since:</strong> {{ user.created_at.strftime('%B %d, %Y') }}</p>
      <p style="margin-bottom: 0;"><strong>Account Type:</strong> 
        {% if user.is_admin %}
          <span style="color: #dc3545;">Admin</span>
        {% else %}
          Regular User
        {% endif %}
      </p>
    </div>
  </div>

</div>

{% endblock %}